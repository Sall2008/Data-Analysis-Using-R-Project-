---
title: "The Effects of School Proximity and the School Social Index on Housing Prices"
subtitle: "\\presentationdate"
author: 
  - name: Yanyi Ji
  - name: Daniel Tobien
  - name: Luc Wichtmann
format: 
  beamer:
    theme: "metropolis"
    colortheme: "seahorse"
    slide-level: 2
    aspectratio: 169
    keep-tex: false
    pdf-engine: xelatex
    include-in-header:
      text: |
        \input{custom_theme.tex}
        \usepackage{booktabs}
        \usepackage{graphicx}
        \usepackage{float}
        \usepackage{amsmath}
        \usepackage{bm}
bibliography: references_results.bib
editor: 
  markdown: 
    wrap: 72
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("Code_Final_Clean.R")
```

## Agenda

**1. Motivation, Existing Literature & Research Question**\
*Why school proximity and social indices matter.*

\vspace{0.3em}

**2. Data & Methodology**\
*Data used and our empirical model.*

\vspace{0.3em}

**3. Results & Main Findings**\
*Presentation and interpretation of our findings.*

\vspace{0.3em}

**4. Limitations & Conclusion**\
*Limitations of our work and concluding thoughts.*

\vspace{0.3em}

# Motivation, Existing Literature & Research Question

## Motivation

-   **Personal Interest**: Analyzing the real estate market's reaction
    to various factors is particularly interesting from an economic
    standpoint, as it offers insights into market dynamics.
    Additionally, the topic is personally intriguing, adding an extra
    layer of motivation to explore it further.

-   **Academic and Practical Relevance**: Housing markets are influenced
    by various social and economic factors, and school quality is also
    cited as a underestimated determinant of property values, especially
    in research [@Seo_Simons_2009].

## Motivation

Understanding the relationship between school distance, school quality
and property prices can provide valuable insights for researchers and
individuals interested in the real estate market.

## Related Literature Background

Several papers have examined the effect of proximity to schools on
housing prices:

-   **Empirical Strategies**: While hedonic models are the dominant
    approach to estimating housing price effects, alternative empirical
    strategies have also been proposed [see @Black_Machin_2011]

-   **Findings**: Empirical evidence suggests that proximity to schools
    positively affects housing prices [@Rosiers_Lagana_Theriault_2001;
    @Huang_Hess_2018]

## Related Literature Background

-   **Other Factors**: Related work also documents capitalization
    effects of school reputation [@Chin_Foong_2006], differences between
    public and private schools [@Sah_Conroy_Narwold_2016] and school
    quality [@Edusei_Espey_Lin_2007; @Metz_2015]

-   **Environment of studies**: Much of the literature focuses on
    settings with binding school catchment areas and measures school
    quality primarily through test scores rather than demographic
    composition.

## Research Question

We study a setting *without binding school catchment areas* (NRW,
Germany) and assess whether both *school proximity* and a
*demographically based school* *social index* are capitalized into
housing prices.

## Research Question

**Research Question:** How do school proximity and school social indices
affect the prices of detached houses, and do these effects differ
between primary and secondary schools in North Rhine–Westphalia?

# Data & Methodology

## Data

-   **Housing Data**: Cross-section dataset for houses for sale
    published by the Research Data Center Ruhr (FDZ Ruhr)
    [@RWI_ImmobilienScout24_2023].
-   **School Data**: School social index dataset from North
    Rhine-Westphalias Ministry of Schools and Education
    [@MSB_NRW_Schulsozialindex].

\footnotetext{Data used from both datasets refer to the year 2022.}

## Pre-Processing of Data

::: {.center data-latex=""}
```{mermaid}
%%| fig-height: 2.9

stateDiagram-v2
    direction LR

    Final: Final Dataset
    state Final {
        
        Housing: Houses for sale
        state Housing {
            [*] --> NA
            NA: Removing NA values
            NA --> File
            File: Including only single-family houses in NRW
            File --> Outl
            Outl: Removing outliers
            Outl --> Dedu
            Dedu: Eliminating duplicates 
            Dedu --> Muta
            Muta: Renaming columns
            Muta --> [*]
        }
        
        School_Dist: School Social Index and Distance
        state School_Dist {

            Index: School Social Index
            state Index {
                [*] --> Types
                Types: Grouping school types
                Types --> Remo
                Remo: Removing invalid values
                Remo --> Muta2
                Muta2: Renaming columns
                Muta2 --> [*]
            }


            Dist: Distance to Schools
            state Dist {
                [*] --> [*]
            }

        }

    }

```
:::

## Empirical Framework

We estimate regression-based hedonic models to

-   examine how school proximity and school characteristics are
    capitalized into housing prices and
-   whether the impact of school proximity on housing prices differs by
    the school’s social index

## Empirical Framework: Hedonic Price Model

\begin{center}
\colorbox{blue!10}{
$\displaystyle
\log(P_i) = 
\beta_0 + 
\beta_1 \text{Dist}_i + 
X_i' \gamma + 
\varepsilon_i
$
}
\end{center}

\vspace{1.5em}

-   $P_i$ denotes the listing price of house $i$ \vspace{0.1em}
-   $\text{Dist}_i$ measures distance to the nearest school
    \vspace{0.1em}
-   $X_i$ is a vector of housing characteristics \vspace{0.1em}
-   $\gamma$ is a vector of coefficients corresponding to $X_i$
    \vspace{0.1em}
-   $\varepsilon_i$ captures unobserved factors

## Empirical Framework: Hedonic Price Model + Interaction

\begin{center}
\colorbox{blue!10}{
$\displaystyle
\log(P_i) = 
\beta_0 + 
\beta_1 ( \text{Index}_i \times \text{Dist}_i ) + 
X_i' \gamma
+ \varepsilon_i
$
}
\end{center}

\vspace{1.5em}

-   $P_i$ denotes the listing price of house $i$ \vspace{0.1em}
-   $\text{Index}_i$ is the school social index \vspace{0.1em}
-   $\text{Dist}_i$ measures distance to the nearest school
    \vspace{0.1em}
-   $X_i$ is a vector of housing characteristics \vspace{0.1em}
-   $\varepsilon_i$ captures unobserved factors

## Empirical Framework: Final Model

\begin{center}
\colorbox{blue!10}{
$\displaystyle
\begin{aligned}
\log(P_i)
&=
\beta_0
+ \beta_1 \text{Dist}_i
+ \beta_2 \text{Index}_i \\
&\quad
+ \beta_3 \left( \text{Dist}_i \times \text{Index}_i \right)
+ X_i' \gamma
+ \mu_{\ell(i)}
+ \varepsilon_i
\end{aligned}
$
}
\end{center}

-   $P_i$ denotes the listing price of house $i$ \vspace{0.1em}
-   $\text{Dist}_i$ measures distance to the nearest school
    \vspace{0.1em}
-   $X_i$ is a vector of housing characteristics \vspace{0.1em}
-   $\text{Index}_i$ is the school social index \vspace{0.1em}
-   $mu_{\ell(i)}$ are municipality fixed effects \vspace{0.1em}
-   $\varepsilon_i$ captures unobserved factors

# Results and Main Findings

## Distance to Schools and House Prices: Hypothesis

\medskip
\fcolorbox{blue!60}{white}{
\parbox{\linewidth}{
\textbf{H1: House prices are higher related to schools}\\[-2pt]
\emph{Expected: Negative coefficients on distance variables}
}}
\medskip

**Empirical Framework**

-   **Outcome**: Log house price
-   **Key variables**: Distance to nearest *primary* school, distance to
    nearest *secondary* school
-   **Modeling Strategy**: Continuous, quadratic, and binned
    specifications

## Distance to Schools and House Prices: Regression Strategy

::::: columns
::: {.column width="50%"}
### Baseline OLS Controls

#### Standardizing housing attributes

-   Living area
-   Plot area
-   Number of rooms
-   House age
:::

::: {.column width="50%"}
### Two Distance Designs

#### Alternative Specifications

1.  Continuous

-   quadratic ($km^2$)

2.  Binned

-   0–3 km, 3–6 km, 6–9 km, \>9 km
:::
:::::

## Regression Specifications {.smaller}

\footnotesize
\vspace{-0.2cm}

::::: columns
::: {.column width="49%"}
\begin{block}{(1) Naive (Unconditional)}
    \vspace{-0.2cm}
    $$\ln(P) = \alpha + \beta_1 D^{prim} + \beta_2 D^{sec} + \varepsilon$$
    \vspace{-0.2cm}
    \begin{itemize}
      \item \textbf{Goal:} Establish raw spatial correlation.
      \item \textbf{Risk:} High Omitted Variable Bias (OVB).
    \end{itemize}
  \end{block}

\vspace{0.2cm}

\begin{exampleblock}{(2) Baseline (Preferred)}
    \vspace{-0.2cm}
    $$\ln(P) = \alpha + \mathbf{\beta D} + \mathbf{\gamma X} + \varepsilon$$
    \vspace{-0.2cm}
    \begin{itemize}
      \item \textbf{Controls:} Area, Plot, Rooms, Age.
      \item \textbf{Hypothesis:} $\beta < 0$ (Negative semi-elasticity).
    \end{itemize}
  \end{exampleblock}
:::

::: {.column width="49%"}
\begin{block}{(3) Non-Linearity (Polynomial)}
    \vspace{-0.2cm}
    $$\ln(P) = \dots + \delta_1 (D^{prim})^2 + \dots$$
    \vspace{-0.2cm}
    \begin{itemize}
      \item \textbf{Test:} $\delta \neq 0$ implies varying MWTP.
      \item \textbf{Logic:} Test for convex/concave decay.
    \end{itemize}
  \end{block}

\vspace{0.2cm}

\begin{block}{(4--5) Robustness (Single Type)}
    \vspace{-0.2cm}
    $$\ln(P) = \alpha + \beta_k D^k + \mathbf{\gamma X} + \varepsilon$$
    \vspace{-0.2cm}
    \begin{itemize}
      \item \textbf{Idea:} Estimate primary / secondary separately.
      \item \textbf{Check:} Stability against multicollinearity.
    \end{itemize}
  \end{block}
:::
:::::

## Descriptive Evidence: Price-Distance Gradient

\vspace{-0.3cm}

\footnotesize

:::::: columns
::: {.column width="32%"}
\begin{block}{Negative Slope (H1)}
    Clear decay in prices as distance increases across specifications.
  \end{block}
:::

::: {.column width="32%"}
\begin{block}{Non-Linearity}
    Steeper drop in the first \textbf{3--6 km}, flattening afterwards.
  \end{block}
:::

::: {.column width="32%"}
\begin{block}{Heterogeneity}
    \textbf{Primary schools} show a visibly steeper gradient than Secondary.
  \end{block}
:::
::::::

```{r}
#| echo: false
#| fig-width: 14
#| fig-height: 4.5
#| fig-align: center
#| warning: false
#| message: false

library(ggplot2)
library(patchwork)

p_left <- fig_2_scatter_combined +
  labs(title = "Fig 1. Continuous Trend (Raw Scatter)") +
  theme(plot.title = element_text(size = 14, face = "bold"))

p_right <- fig_1_price_gradient +
  labs(title = "Fig 2. Discrete Gradient (Binned Means)") +
  theme(plot.title = element_text(size = 14, face = "bold"),
        axis.title.y = element_blank())

p_combined <- p_left + p_right +
  plot_layout(guides = "collect") & 
  theme(legend.position = "top",
        legend.box.margin = margin(0, 0, 0, 0),
        legend.margin = margin(0, 0, 0, 0))

print(p_combined)
```

## Main Results: Continuous Model {.smaller}

```{r}
#| echo: false
#| results: asis

modelsummary(
  models_cont,
  vcov      = "HC1",
  coef_map  = coef_map_cont,
  statistic = NULL,
  stars     = c("*" = .1, "**" = .05, "***" = .01),
  gof_map   = c("nobs", "r.squared", "adj.r.squared"),
  fmt       = 3,
  output    = "kableExtra"
) |>
  kableExtra::kable_styling(font_size = 7, latex_options = c("scale_down", "hold_position"))
```

## Main Results: Binned Model {.smaller}

```{r}
#| echo: false
#| results: asis

modelsummary(
  models_bin,
  vcov      = "HC1",
  statistic = NULL,
  stars     = c("*" = .1, "**" = .05, "***" = .01),
  gof_map   = c("nobs", "r.squared", "adj.r.squared"),
  fmt       = 3,
  output    = "kableExtra"
) |>
  kableExtra::kable_styling(font_size = 7, latex_options = c("scale_down", "hold_position"))
```

## Compare: Continuous vs Binned {.smaller}

```{r}
#| echo: false
#| results: asis

modelsummary(
  models_main_compare,
  vcov      = "HC1",
  coef_map  = coef_map_compare,
  coef_omit = "log_area|log_plot_area|zimmeranzahl|house_age|\\(Intercept\\)",
  statistic = NULL,
  stars     = c("*" = .1, "**" = .05, "***" = .01),
  gof_map   = c("nobs", "r.squared", "adj.r.squared"),
  fmt       = 3,
  output    = "kableExtra"
) |>
  kableExtra::kable_styling(font_size = 7, latex_options = c("scale_down", "hold_position")) |>
  kableExtra::footnote(general = "Binned coefficients are relative to the reference group: 0-3 km. Controls included but omitted from display.")
```

## Model comparison (main models)

-   Continuous fits slightly better.

### In-sample fit and 5-fold out-of-sample performance

```{r}
#| echo: false

tab_4_compare_all <- compare_all %>%
  setNames(c("Model", "N", "$R^2$", "Adj. $R^2$", "AIC", "BIC", 
             "CV RMSE", "CV MAE", "CV $R^2$")) %>%
  knitr::kable(
    format = "latex",
    digits = 3,                  
    booktabs = TRUE,            
    escape = FALSE,               
    linesep = ""                 
  ) %>%
  
  kableExtra::kable_styling(
    font_size = 7, 
    latex_options = c("scale_down", "hold_position")
  ) %>%
  
  kableExtra::footnote(
    general = "In-sample: higher $R^2$/Adj. $R^2$ is better; 
    lower AIC/BIC is better. 
    Out-of-sample (5-fold CV): lower RMSE/MAE is better; 
    higher $R^2$ is better.",
    general_title = "Note: ",
    threeparttable = TRUE,
    escape = FALSE 
  )

tab_4_compare_all

```

## Robustness checks (main models)

-   Binned is slightly more robust to influential points.

### Diagnostics summary (heteroskedasticity, multicollinearity, influence)

```{r}
#| echo: false
tab_5_robust_checks <- diag_robust %>%
  mutate(
    BP_pvalue = if_else(is.na(BP_pvalue), NA_character_,
                        if_else(BP_pvalue < 0.001, "<0.001", 
                                sprintf("%.3f", BP_pvalue))),
    Max_VIF   = if_else(is.na(Max_VIF), NA_character_, 
                        sprintf("%.2f", Max_VIF)),
    Cook_max  = if_else(is.na(Cook_max), NA_character_, 
                        sprintf("%.3f", Cook_max)),
    Cook_n_gt_4n = as.integer(Cook_n_gt_4n)
  ) %>%
  select(Model, BP_pvalue, Max_VIF, Cook_n_gt_4n, Cook_max) %>%
  setNames(c("Model", "BP p-value", "Max VIF", "Influential ($D > 4/n$)", "Max Cook's $D$")) %>%
  knitr::kable(
    format = "latex",
    booktabs = TRUE,
    escape = FALSE,  
    linesep = "",
    align = "lcccc"
  ) %>%
  kableExtra::kable_styling(
    font_size = 7, 
    latex_options = c("scale_down", "hold_position")
  ) %>%
  kableExtra::column_spec(1, bold = TRUE) %>%
  kableExtra::footnote(
    general = "Inference uses \\textbf{HC1 robust SE}. Lower BP p-values indicate heteroskedasticity; higher VIF indicates collinearity; larger Cook's $D$ indicates influential points.",
    general_title = "Note: ",
    threeparttable = TRUE,
    escape = FALSE
  )

tab_5_robust_checks
```

## Robustness check: Queen contiguity (Distance)

```{r}
#| echo: false
#| results: asis
#| include: true
table_qc_dist
```

## Economic Mechanisms & Interpretations

\footnotesize
\vspace{-0.3cm}

::: columns

::: {.column width="32%"}
  \begin{block}{1. Capitalization}
    \vspace{0.1cm}
    \centering
    \textit{Why closer = expensive?}
    \vspace{0.1cm}
    \begin{itemize}
      \item \textbf{Convenience Premium:} \\
      Time savings $\to$ Capitalized into property values.
      \item \textbf{Sorting:} \\
      Families cluster $\to$ Higher local demand.
    \end{itemize}
  \end{block}
:::

::: {.column width="32%"}
  \begin{exampleblock}{2. Primary vs Secondary}
    \vspace{0.1cm}
    \centering
    \textit{Why primary is stronger?}
    \vspace{0.1cm}
    \begin{itemize}
      \item \textbf{Age Constraints:} \\
      Young kids need escorting (Inelastic demand).
      \item \textbf{Micro-Neighborhoods:} \\
      Primary schools anchor local community ties.
    \end{itemize}
  \end{exampleblock}
:::

::: {.column width="32%"}
  \begin{alertblock}{3. Non-Linearity}
    \vspace{0.1cm}
    \centering
    \textit{Why gradient flattens?}
    \vspace{0.1cm}
    \begin{itemize}
      \item \textbf{Walkability Limit:} \\
      Premium vanishes after \textbf{3km}.
      \item \textbf{Substitution:} \\
      Driving $\to$ Public transit at longer distances.
    \end{itemize}
  \end{alertblock}
:::

:::

## Exploring the Social Index Impact on House Prices

\medskip
\fcolorbox{blue!60}{white}{
\parbox{\linewidth}{
\textbf{H2: Social index moderates the effect of school proximity on house prices}\\[-2pt]
\emph{Expected: Better schools leading to stronger price premiums}
}}
\medskip

-   **Key Finding from Distance Analysis:** We’ve already established that *households are willing to pay a premium* for proximity to schools
-   **Next Question:** Now, we investigate *whether this price premium is driven by school quality*, measured through the *Social Index*


## What is the Social Index?

**Definition**: The Social Index is a measure that shows the socio-economic and demographic background of a schools students.
  
**Components of the social index are**:

-   Parental Education 
-   Socio-economic Status of the Family 
-   Migration Background
-   Single-Parent Household
-   Unemployment in the Family 
-   Housing Situation 
  
--> It provides insights into the **social environment** that might influence housing prices in that area.


## Categorization of the Social Index

**Social Index Classification:**

-   **Good Schools**: Social Index 1-2
-   **Average Schools**: Social Index 3-4
-   **Bad Schools**: Social Index 5-8

-    **Skewed Distribution**: The Social Index classes are heavily skewed, with many schools falling into classes 1, 2 & 3. We excluded class 9 for our analysis because of too less observations
  

## Categorization of the Social Index: Bar Chart

```{r}
#| fig.width: 6
#| fig.height: 3.4
#| fig.align: center
#| out.width: "90%"
bar_chart_index
```

**Graph**: Distribution of Social Index values across schools showing the skewed nature of the data.

## Spatial Distribution of School Social Index in NRW

```{r}
#| fig.width: 6
#| fig.height: 3.4
#| fig.align: center
#| out.width: "90%"
spa_dis
```

## Hedonic Regression Model for Social Index 

### Model Specification:


## Social Index: Regression Results



```{r}
#| echo: false
#| results: asis
#| include: true
tab_ols
```

## Robustness check: Queen contiguity (Social Index)

```{r}
#| echo: false
#| results: asis
#| include: true
table_qc_index
```

## Social Index: Interpretaition of the Results
### Primary School Proximity

-   *Distance to primary school* is still *significant* and negatively affects house prices.
-   Interaction Effect: The effect is *stronger for average schools* (Estimate = -0.041, p = 0.009), suggesting that the price drop is greater when the school quality is average.
-   *No significant effect* for bad schools (p = 0.2996).
  
## Social Index: Interpretaition of the Results
### Secondary School Proximity

-   *Distance to secondary school* is also still *significant* and negatively impacts house prices.
-   The effect is *stronger for average schools* (Estimate = 0.0307, p = 0.0096), meaning proximity to secondary schools is more impactful in areas with average school quality.
-   *No significant effect* for bad schools (p = 0.7414).

# Limitations and Concluding Thoughts

-   **Direct Distance**: The distance is not measured from the houses to
    the nearest school directly but from the school to the center of the
    raster cell.
-   **Fragmented Grid**: We do not have data for every grid cell of NRW
    but only a fragmented set of grids containing houses from the
    available datasets.
-   **Listing prices**: The prices we have are not transaction but
    listing prices.

## Limitation: Direct Distance

::::: {.columns align=center .onlytextwidth}
::: {.column width="35%"}
The distance is not measured from the houses to the nearest school directly but
from the school to the center of the raster cell.
:::
::: {.column width="65%"}
```{r}
#| echo: false
#| include: true
plot_lim_dist
```
:::
:::::

## Limitation: Fragmented Grid

::::: {.columns align=center .onlytextwidth}
::: {.column width="35%"}
We do not have data for every grid cell of NRW but only a fragmented set of grids containing houses from the available datasets.
:::
::: {.column width="65%"}
```{r}
#| echo: false
#| include: true

```

:::
:::::

```{=html}
<!-- This part has to stay on the last page before the references to indicate
the end of the presentation for the progress bar defined in the custom 
theme file.
This does not work yet... -->
```

\setcontentend


## References {.allowframebreaks}

::: {#refs}
:::
